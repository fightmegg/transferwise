cf4438d4d055981859fc36fe99a4ffad
"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = void 0;

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

var _querystring = require("querystring");

var _webhooks = require("./webhooks");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

const SANDBOX_URL = "https://api.sandbox.transferwise.tech";
const LIVE_URL = "https://api.transferwise.com";
const VERSION = "v1";

class TransferWise {
  constructor({
    token,
    sandbox = false
  } = {}) {
    if (!token) throw new Error("token is required");
    this.token = token;
    this.sandbox = sandbox;
    this.url = sandbox ? SANDBOX_URL : LIVE_URL;
  }

  request({
    method = "GET",
    path = "",
    body,
    version
  } = {}) {
    const apiVersion = `/${version || VERSION}`;
    const url = this.url + apiVersion + path;
    const fetchOptions = {
      method,
      json: true,
      headers: {
        Authorization: `Bearer ${this.token}`,
        "Content-Type": "application/json",
        "cache-control": "no-cache"
      }
    };
    if (body) fetchOptions.body = JSON.stringify(body);
    if (method === "DELETE") return (0, _nodeFetch.default)(url, fetchOptions);
    return (0, _nodeFetch.default)(url, fetchOptions).then(resp => resp.json());
  }

  profiles() {
    return this.request({
      path: "/profiles"
    });
  }

  borderlessAccounts(profileId) {
    return this.request({
      path: `/borderless-accounts?profileId=${profileId}`
    });
  }

  get recipientAccounts() {
    return {
      create: accountDetails => this.request({
        method: "POST",
        body: accountDetails,
        path: "/accounts"
      }),
      get: accountId => this.request({
        path: `/accounts/${accountId}`
      }),
      delete: accountId => this.request({
        method: "DELETE",
        path: `/accounts/${accountId}`
      }),
      list: params => this.request({
        path: `/accounts?${(0, _querystring.encode)(params)}`
      })
    };
  }

  get quotes() {
    return {
      temporary: params => this.request({
        path: `/quotes?${(0, _querystring.encode)(params)}`
      }),
      create: quoteDetails => this.request({
        method: "POST",
        body: quoteDetails,
        path: "/quotes"
      }),
      get: quoteId => this.request({
        path: `/quotes/${quoteId}`
      })
    };
  }

  get transfers() {
    return {
      create: transferDetails => this.request({
        method: "POST",
        body: transferDetails,
        path: "/transfers"
      }),
      cancel: transferId => this.request({
        method: "PUT",
        path: `/transfers/${transferId}/cancel`
      }),
      get: transferId => this.request({
        path: `/transfers/${transferId}`
      }),
      issues: transferId => this.request({
        path: `/transfers/${transferId}/issues`
      }),
      fund: (profileId, transferId) => this.request({
        method: "POST",
        version: "v3",
        body: {
          type: "BALANCE"
        },
        path: `/profiles/${profileId}/transfers/${transferId}/payments`
      }),
      deliveryEstimate: transferId => this.request({
        path: `/delivery-estimates/${transferId}`
      }),
      list: params => this.request({
        path: `/transfers?${(0, _querystring.encode)(params)}`
      })
    };
  }

  get simulation() {
    return {
      transfers: {
        processing: transferId => this.request({
          path: `/simulation/transfers/${transferId}/processing`
        }),
        fundsConverted: transferId => this.request({
          path: `/simulation/transfers/${transferId}/funds_converted`
        }),
        outgoingPaymentSent: transferId => this.request({
          path: `/simulation/transfers/${transferId}/outgoing_payment_sent`
        }),
        bouncedBack: transferId => this.request({
          path: `/simulation/transfers/${transferId}/bounced_back`
        }),
        fundsRefunded: transferId => this.request({
          path: `/simulation/transfers/${transferId}/funds_refunded`
        })
      }
    };
  }

  get webhooks() {
    return {
      constructEvent: (body, signature) => (0, _webhooks.constructEvent)(this.sandbox, body, signature)
    };
  }

}

var _default = TransferWise;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LmpzIl0sIm5hbWVzIjpbIlNBTkRCT1hfVVJMIiwiTElWRV9VUkwiLCJWRVJTSU9OIiwiVHJhbnNmZXJXaXNlIiwiY29uc3RydWN0b3IiLCJ0b2tlbiIsInNhbmRib3giLCJFcnJvciIsInVybCIsInJlcXVlc3QiLCJtZXRob2QiLCJwYXRoIiwiYm9keSIsInZlcnNpb24iLCJhcGlWZXJzaW9uIiwiZmV0Y2hPcHRpb25zIiwianNvbiIsImhlYWRlcnMiLCJBdXRob3JpemF0aW9uIiwiSlNPTiIsInN0cmluZ2lmeSIsInRoZW4iLCJyZXNwIiwicHJvZmlsZXMiLCJib3JkZXJsZXNzQWNjb3VudHMiLCJwcm9maWxlSWQiLCJyZWNpcGllbnRBY2NvdW50cyIsImNyZWF0ZSIsImFjY291bnREZXRhaWxzIiwiZ2V0IiwiYWNjb3VudElkIiwiZGVsZXRlIiwibGlzdCIsInBhcmFtcyIsInF1b3RlcyIsInRlbXBvcmFyeSIsInF1b3RlRGV0YWlscyIsInF1b3RlSWQiLCJ0cmFuc2ZlcnMiLCJ0cmFuc2ZlckRldGFpbHMiLCJjYW5jZWwiLCJ0cmFuc2ZlcklkIiwiaXNzdWVzIiwiZnVuZCIsInR5cGUiLCJkZWxpdmVyeUVzdGltYXRlIiwic2ltdWxhdGlvbiIsInByb2Nlc3NpbmciLCJmdW5kc0NvbnZlcnRlZCIsIm91dGdvaW5nUGF5bWVudFNlbnQiLCJib3VuY2VkQmFjayIsImZ1bmRzUmVmdW5kZWQiLCJ3ZWJob29rcyIsImNvbnN0cnVjdEV2ZW50Iiwic2lnbmF0dXJlIl0sIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUE7O0FBQ0E7O0FBQ0E7Ozs7QUFFQSxNQUFNQSxXQUFXLEdBQUcsdUNBQXBCO0FBQ0EsTUFBTUMsUUFBUSxHQUFHLDhCQUFqQjtBQUVBLE1BQU1DLE9BQU8sR0FBRyxJQUFoQjs7QUFFQSxNQUFNQyxZQUFOLENBQW1CO0FBQ2pCQyxFQUFBQSxXQUFXLENBQUM7QUFBRUMsSUFBQUEsS0FBRjtBQUFTQyxJQUFBQSxPQUFPLEdBQUc7QUFBbkIs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QyxNQUFBQSxjQUFjLEVBQUUsQ0FBQ3pDLElBQUQsRUFBTzBDLFNBQVAsS0FDZCw4QkFBZSxLQUFLaEQsT0FBcEIsRUFBNkJNLElBQTdCLEVBQW1DMEMsU0FBbkM7QUFGRyxLQUFQO0FBSUQ7O0FBekhnQjs7ZUE0SEpuRCxZIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGZldGNoIGZyb20gXCJub2RlLWZldGNoXCI7XG5pbXBvcnQgeyBlbmNvZGUgfSBmcm9tIFwicXVlcnlzdHJpbmdcIjtcbmltcG9ydCB7IGNvbnN0cnVjdEV2ZW50IH0gZnJvbSBcIi4vd2ViaG9va3NcIjtcblxuY29uc3QgU0FOREJPWF9VUkwgPSBcImh0dHBzOi8vYXBpLnNhbmRib3gudHJhbnNmZXJ3aXNlLnRlY2hcIjtcbmNvbnN0IExJVkVfVVJMID0gXCJodHRwczovL2FwaS50cmFuc2Zlcndpc2UuY29tXCI7XG5cbmNvbnN0IFZFUlNJT04gPSBcInYxXCI7XG5cbmNsYXNzIFRyYW5zZmVyV2lzZSB7XG4gIGNvbnN0cnVjdG9yKHsgdG9rZW4sIHNhbmRib3ggPSBmYWxzZSB9ID0ge30pIHtcbiAgICBpZiAoIXRva2VuKSB0aHJvdyBuZXcgRXJyb3IoXCJ0b2tlbiBpcyByZXF1aXJlZFwiKTtcblxuICAgIHRoaXMudG9rZW4gPSB0b2tlbjtcbiAgICB0aGlzLnNhbmRib3ggPSBzYW5kYm94O1xuICAgIHRoaXMudXJsID0gc2FuZGJveCA/IFNBTkRCT1hfVVJMIDogTElWRV9VUkw7XG4gIH1cblxuICByZXF1ZXN0KHsgbWV0aG9kID0gXCJHRVRcIiwgcGF0aCA9IFwiXCIsIGJvZHksIHZlcnNpb24gfSA9IHt9KSB7XG4gICAgY29uc3QgYXBpVmVyc2lvbiA9IGAvJHt2ZXJzaW9uIHx8IFZFUlNJT059YDtcbiAgICBjb25zdCB1cmwgPSB0aGlzLnVybCArIGFwaVZlcnNpb24gKyBwYXRoO1xuICAgIGNvbnN0IGZldGNoT3B0aW9ucyA9IHtcbiAgICAgIG1ldGhvZCxcbiAgICAgIGpzb246IHRydWUsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHt0aGlzLnRva2VufWAsXG4gICAgICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICAgICAgICBcImNhY2hlLWNvbnRyb2xcIjogXCJuby1jYWNoZVwiXG4gICAgICB9XG4gICAgfTtcbiAgICBpZiAoYm9keSkgZmV0Y2hPcHRpb25zLmJvZHkgPSBKU09OLnN0cmluZ2lmeShib2R5KTtcbiAgICBpZiAobWV0aG9kID09PSBcIkRFTEVURVwiKSByZXR1cm4gZmV0Y2godXJsLCBmZXRjaE9wdGlvbnMpO1xuICAgIHJldHVybiBmZXRjaCh1cmwsIGZldGNoT3B0aW9ucykudGhlbihyZXNwID0+IHJlc3AuanNvbigpKTtcbiAgfVxuXG4gIHByb2ZpbGVzKCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3QoeyBwYXRoOiBcIi9wcm9maWxlc1wiIH0pO1xuICB9XG5cbiAgYm9yZGVybGVzc0FjY291bnRzKHByb2ZpbGVJZCkge1xuICAgIHJldHVybiB0aGlzLnJlcXVlc3Qoe1xuICAgICAgcGF0aDogYC9ib3JkZXJsZXNzLWFjY291bnRzP3Byb2ZpbGVJZD0ke3Byb2ZpbGVJZH1gXG4gICAgfSk7XG4gIH1cblxuICBnZXQgcmVjaXBpZW50QWNjb3VudHMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNyZWF0ZTogYWNjb3VudERldGFpbHMgPT5cbiAgICAgICAgdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGJvZHk6IGFjY291bnREZXRhaWxzLFxuICAgICAgICAgIHBhdGg6IFwiL2FjY291bnRzXCJcbiAgICAgICAgfSksXG4gICAgICBnZXQ6IGFjY291bnRJZCA9PiB0aGlzLnJlcXVlc3QoeyBwYXRoOiBgL2FjY291bnRzLyR7YWNjb3VudElkfWAgfSksXG4gICAgICBkZWxldGU6IGFjY291bnRJZCA9PlxuICAgICAgICB0aGlzLnJlcXVlc3QoeyBtZXRob2Q6IFwiREVMRVRFXCIsIHBhdGg6IGAvYWNjb3VudHMvJHthY2NvdW50SWR9YCB9KSxcbiAgICAgIGxpc3Q6IHBhcmFtcyA9PiB0aGlzLnJlcXVlc3QoeyBwYXRoOiBgL2FjY291bnRzPyR7ZW5jb2RlKHBhcmFtcyl9YCB9KVxuICAgIH07XG4gIH1cblxuICBnZXQgcXVvdGVzKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0ZW1wb3Jhcnk6IHBhcmFtcyA9PiB0aGlzLnJlcXVlc3QoeyBwYXRoOiBgL3F1b3Rlcz8ke2VuY29kZShwYXJhbXMpfWAgfSksXG4gICAgICBjcmVhdGU6IHF1b3RlRGV0YWlscyA9PlxuICAgICAgICB0aGlzLnJlcXVlc3QoeyBtZXRob2Q6IFwiUE9TVFwiLCBib2R5OiBxdW90ZURldGFpbHMsIHBhdGg6IFwiL3F1b3Rlc1wiIH0pLFxuICAgICAgZ2V0OiBxdW90ZUlkID0+IHRoaXMucmVxdWVzdCh7IHBhdGg6IGAvcXVvdGVzLyR7cXVvdGVJZH1gIH0pXG4gICAgfTtcbiAgfVxuXG4gIGdldCB0cmFuc2ZlcnMoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNyZWF0ZTogdHJhbnNmZXJEZXRhaWxzID0+XG4gICAgICAgIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICBib2R5OiB0cmFuc2ZlckRldGFpbHMsXG4gICAgICAgICAgcGF0aDogXCIvdHJhbnNmZXJzXCJcbiAgICAgICAgfSksXG4gICAgICBjYW5jZWw6IHRyYW5zZmVySWQgPT5cbiAgICAgICAgdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICBtZXRob2Q6IFwiUFVUXCIsXG4gICAgICAgICAgcGF0aDogYC90cmFuc2ZlcnMvJHt0cmFuc2ZlcklkfS9jYW5jZWxgXG4gICAgICAgIH0pLFxuICAgICAgZ2V0OiB0cmFuc2ZlcklkID0+IHRoaXMucmVxdWVzdCh7IHBhdGg6IGAvdHJhbnNmZXJzLyR7dHJhbnNmZXJJZH1gIH0pLFxuICAgICAgaXNzdWVzOiB0cmFuc2ZlcklkID0+XG4gICAgICAgIHRoaXMucmVxdWVzdCh7IHBhdGg6IGAvdHJhbnNmZXJzLyR7dHJhbnNmZXJJZH0vaXNzdWVzYCB9KSxcbiAgICAgIGZ1bmQ6IChwcm9maWxlSWQsIHRyYW5zZmVySWQpID0+XG4gICAgICAgIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgICAgICB2ZXJzaW9uOiBcInYzXCIsXG4gICAgICAgICAgYm9keTogeyB0eXBlOiBcIkJBTEFOQ0VcIiB9LFxuICAgICAgICAgIHBhdGg6IGAvcHJvZmlsZXMvJHtwcm9maWxlSWR9L3RyYW5zZmVycy8ke3RyYW5zZmVySWR9L3BheW1lbnRzYFxuICAgICAgICB9KSxcbiAgICAgIGRlbGl2ZXJ5RXN0aW1hdGU6IHRyYW5zZmVySWQgPT5cbiAgICAgICAgdGhpcy5yZXF1ZXN0KHsgcGF0aDogYC9kZWxpdmVyeS1lc3RpbWF0ZXMvJHt0cmFuc2ZlcklkfWAgfSksXG4gICAgICBsaXN0OiBwYXJhbXMgPT4gdGhpcy5yZXF1ZXN0KHsgcGF0aDogYC90cmFuc2ZlcnM/JHtlbmNvZGUocGFyYW1zKX1gIH0pXG4gICAgfTtcbiAgfVxuXG4gIGdldCBzaW11bGF0aW9uKCkge1xuICAgIHJldHVybiB7XG4gICAgICB0cmFuc2ZlcnM6IHtcbiAgICAgICAgcHJvY2Vzc2luZzogdHJhbnNmZXJJZCA9PlxuICAgICAgICAgIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiBgL3NpbXVsYXRpb24vdHJhbnNmZXJzLyR7dHJhbnNmZXJJZH0vcHJvY2Vzc2luZ2BcbiAgICAgICAgICB9KSxcbiAgICAgICAgZnVuZHNDb252ZXJ0ZWQ6IHRyYW5zZmVySWQgPT5cbiAgICAgICAgICB0aGlzLnJlcXVlc3Qoe1xuICAgICAgICAgICAgcGF0aDogYC9zaW11bGF0aW9uL3RyYW5zZmVycy8ke3RyYW5zZmVySWR9L2Z1bmRzX2NvbnZlcnRlZGBcbiAgICAgICAgICB9KSxcbiAgICAgICAgb3V0Z29pbmdQYXltZW50U2VudDogdHJhbnNmZXJJZCA9PlxuICAgICAgICAgIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiBgL3NpbXVsYXRpb24vdHJhbnNmZXJzLyR7dHJhbnNmZXJJZH0vb3V0Z29pbmdfcGF5bWVudF9zZW50YFxuICAgICAgICAgIH0pLFxuICAgICAgICBib3VuY2VkQmFjazogdHJhbnNmZXJJZCA9PlxuICAgICAgICAgIHRoaXMucmVxdWVzdCh7XG4gICAgICAgICAgICBwYXRoOiBgL3NpbXVsYXRpb24vdHJhbnNmZXJzLyR7dHJhbnNmZXJJZH0vYm91bmNlZF9iYWNrYFxuICAgICAgICAgIH0pLFxuICAgICAgICBmdW5kc1JlZnVuZGVkOiB0cmFuc2ZlcklkID0+XG4gICAgICAgICAgdGhpcy5yZXF1ZXN0KHtcbiAgICAgICAgICAgIHBhdGg6IGAvc2ltdWxhdGlvbi90cmFuc2ZlcnMvJHt0cmFuc2ZlcklkfS9mdW5kc19yZWZ1bmRlZGBcbiAgICAgICAgICB9KVxuICAgICAgfVxuICAgIH07XG4gIH1cblxuICBnZXQgd2ViaG9va3MoKSB7XG4gICAgcmV0dXJuIHtcbiAgICAgIGNvbnN0cnVjdEV2ZW50OiAoYm9keSwgc2lnbmF0dXJlKSA9PlxuICAgICAgICBjb25zdHJ1Y3RFdmVudCh0aGlzLnNhbmRib3gsIGJvZHksIHNpZ25hdHVyZSlcbiAgICB9O1xuICB9XG59XG5cbmV4cG9ydCBkZWZhdWx0IFRyYW5zZmVyV2lzZTtcbiJdfQ==