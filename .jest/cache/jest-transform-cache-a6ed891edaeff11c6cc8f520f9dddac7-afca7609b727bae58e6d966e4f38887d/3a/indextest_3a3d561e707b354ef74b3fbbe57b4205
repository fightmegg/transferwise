32abf358d4e0ac22d4c1c050f4d32214
"use strict";

_getJestObj().mock("../webhooks", () => ({
  __esModule: true,
  constructEvent: jest.fn()
}));

_getJestObj().mock("node-fetch", () => jest.fn());

var _nodeFetch = _interopRequireDefault(require("node-fetch"));

var _index = _interopRequireDefault(require("../index"));

var _webhooks = require("../webhooks");

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

function _getJestObj() {
  const {
    jest
  } = require("@jest/globals");

  _getJestObj = () => jest;

  return jest;
}

describe("TransferWise", () => {
  beforeEach(() => {
    jest.resetAllMocks();
  });
  describe("constructor", () => {
    test("it THROWS if no token is given", () => {
      const tw = () => new _index.default();

      expect(tw).toThrowError(new Error("token is required"));
    });
    test("it sets instance variables correctly for sandbox", () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      expect(tw.token).toEqual("1234");
      expect(tw.sandbox).toEqual(true);
      expect(tw.url).toEqual("https://api.sandbox.transferwise.tech");
    });
    test("it sets instance variables correctly for live", () => {
      const tw = new _index.default({
        token: "1234"
      });
      expect(tw.token).toEqual("1234");
      expect(tw.sandbox).toEqual(false);
      expect(tw.url).toEqual("https://api.transferwise.com");
    });
  });
  describe("request", () => {
    beforeEach(() => {
      _nodeFetch.default.mockReturnValue({
        then: jest.fn()
      });
    });
    test("it calls fetch with defaults", () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request();
      expect(_nodeFetch.default).toHaveBeenCalledTimes(1);
      expect(_nodeFetch.default).toHaveBeenCalledWith("https://api.sandbox.transferwise.tech/v1", {
        method: "GET",
        json: true,
        headers: {
          Authorization: `Bearer 1234`,
          "Content-Type": "application/json",
          "cache-control": "no-cache"
        }
      });
    });
    test("it calls fetch with custom version & path", () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request({
        version: "v3",
        path: "/profiles"
      });
      expect(_nodeFetch.default).toHaveBeenCalledWith("https://api.sandbox.transferwise.tech/v3/profiles", expect.any(Object));
    });
    test("it calls fetch with custom method & json body", () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request({
        version: "v3",
        path: "/profiles",
        method: "POST",
        body: {
          type: "BALANCE"
        }
      });
      expect(_nodeFetch.default).toHaveBeenCalledWith("https://api.sandbox.transferwise.tech/v3/profiles", {
        method: "POST",
        json: true,
        body: JSON.stringify({
          type: "BALANCE"
        }),
        headers: expect.any(Object)
      });
    });
  });
  describe("profiles", () => {
    test('it calls request with { path: "/profiles" }', () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request = jest.fn();
      tw.profiles();
      expect(tw.request).toHaveBeenCalledWith({
        path: "/profiles"
      });
    });
  });
  describe("borderlessAccounts", () => {
    test('it calls request with { path: "/borderless-accounts?profileId=2486" }', () => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request = jest.fn();
      tw.borderlessAccounts(2486);
      expect(tw.request).toHaveBeenCalledWith({
        path: "/borderless-accounts?profileId=2486"
      });
    });
  });
  describe("recipientAccounts", () => {
    test.each([["create", {
      method: "POST",
      path: "/accounts",
      body: {
        profile: 2486
      }
    }, {
      profile: 2486
    }], ["get", {
      path: "/accounts/222222"
    }, 222222], ["delete", {
      method: "DELETE",
      path: "/accounts/222222"
    }, 222222], ["list", {
      path: "/accounts?currency=GBP"
    }, {
      currency: "GBP"
    }]])(".%s calls request with %o", (fn, params, input) => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request = jest.fn();
      tw.recipientAccounts[fn](input);
      expect(tw.request).toHaveBeenCalledWith(params);
    });
  });
  describe("quotes", () => {
    test.each([["temporary", {
      path: "/quotes?source=GBP"
    }, {
      source: "GBP"
    }], ["create", {
      method: "POST",
      path: "/quotes",
      body: {
        profile: 2486
      }
    }, {
      profile: 2486
    }], ["get", {
      path: "/quotes/222222"
    }, 222222]])(".%s calls request with %o", (fn, params, input) => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request = jest.fn();
      tw.quotes[fn](input);
      expect(tw.request).toHaveBeenCalledWith(params);
    });
  });
  describe("transfers", () => {
    test.each([["create", {
      method: "POST",
      path: "/transfers",
      body: {
        targetAccount: 222222
      }
    }, {
      targetAccount: 222222
    }, null], ["cancel", {
      method: "PUT",
      path: "/transfers/222222/cancel"
    }, 222222, null], ["get", {
      path: "/transfers/222222"
    }, 222222, null], ["issues", {
      path: "/transfers/222222/issues"
    }, 222222, null], ["fund", {
      method: "POST",
      version: "v3",
      path: "/profiles/2486/transfers/222222/payments",
      body: {
        type: "BALANCE"
      }
    }, 2486, 222222], ["deliveryEstimate", {
      path: "/delivery-estimates/222222"
    }, 222222, null], ["list", {
      path: "/transfers?profile=2486"
    }, {
      profile: 2486
    }, null]])(".%s calls request with %o", (fn, params, input, input2) => {
      const tw = new _index.default({
        token: "1234",
        sandbox: true
      });
      tw.request = jest.fn();
      tw.transfers[fn](input, input2);
      expect(tw.request).toHaveBeenCalledWith(params);
    });
  });
  describe("simulation", () => {
    describe("transfers", () => {
      test.each([["processing", {
        path: "/simulation/transfers/222222/processing"
      }, 222222], ["fundsConverted", {
        path: "/simulation/transfers/222222/funds_converted"
      }, 222222], ["outgoingPaymentSent", {
        path: "/simulation/transfers/222222/outgoing_payment_sent"
      }, 222222], ["bouncedBack", {
        path: "/simulation/transfers/222222/bounced_back"
      }, 222222], ["fundsRefunded", {
        path: "/simulation/transfers/222222/funds_refunded"
      }, 222222]])(".%s calls request with %o", (fn, params, input) => {
        const tw = new _index.default({
          token: "1234",
          sandbox: true
        });
        tw.request = jest.fn();
        tw.simulation.transfers[fn](input);
        expect(tw.request).toHaveBeenCalledWith(params);
      });
    });
  });
  describe("webhooks", () => {
    describe("constructEvent", () => {
      test("constructEvent calls constructEvent with (sandbox=true, payload, signature)", () => {
        const tw = new _index.default({
          token: "1234",
          sandbox: true
        });
        tw.webhooks.constructEvent("payload", "signature");
        expect(_webhooks.constructEvent).toHaveBeenCalledTimes(1);
        expect(_webhooks.constructEvent).toHaveBeenCalledWith(true, "payload", "signature");
      });
      test("constructEvent calls constructEvent with (sandbox=true, payload, signature)", () => {
        const tw = new _index.default({
          token: "1234",
          sandbox: false
        });
        tw.webhooks.constructEvent("payload", "signature");
        expect(_webhooks.constructEvent).toHaveBeenCalledTimes(1);
        expect(_webhooks.constructEvent).toHaveBeenCalledWith(false, "payload", "signature");
      });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRlc3QuanMiXSwibmFtZXMiOlsibW9jayIsIl9fZXNNb2R1bGUiLCJjb25zdHJ1Y3RFdmVudCIsImplc3QiLCJmbiIsImRlc2NyaWJlIiwiYmVmb3JlRWFjaCIsInJlc2V0QWxsTW9ja3MiLCJ0ZXN0IiwidHciLCJUcmFuc2Zlcldpc2UiLCJleHBlY3QiLCJ0b1Rocm93RXJyb3IiLCJFcnJvciIsInRva2VuIiwic2FuZGJveCIsInRvRXF1YWwiLCJ1cmwiLCJmZXRjaCIsIm1vY2tSZXR1cm5WYWx1ZSIsInRoZW4iLCJyZXF1ZXN0IiwidG9IYXZlQmVlbkNhbGxlZFRpbWVzIiwidG9IYXZlQmVlbkNhbGxlZFdpdGgiLCJtZXRob2QiLCJqc29uIiwiaGVhZGVycyIsIkF1dGhvcml6YXRpb24iLCJ2ZXJzaW9uIiwicGF0aCIsImFueSIsIk9iamVjdCIsImJvZHkiLCJ0eXBlIiwiSlNPTiIsInN0cmluZ2lmeSIsInByb2ZpbGVzIiwiYm9yZGVybGVzc0FjY291bnRzIiwiZWFjaCIsInByb2ZpbGUiLCJjdXJyZW5jeSIsInBhcmFtcyIsImlucHV0IiwicmVjaXBpZW50QWNjb3VudHMiLCJzb3VyY2UiLCJxdW90ZXMiLCJ0YXJnZXRBY2NvdW50IiwiaW5wdXQyIiwidHJhbnNmZXJzIiwic2ltdWxhdGlvbiIsIndlYmhvb2tzIl0sIm1hcHBpbmdzIjoiOztBQU1BLGNBQUtBLElBQUwsQ0FBVSxhQUFWLEVBQXlCLE9BQU87QUFDOUJDLEVBQUFBLFVBQVUsRUFBRSxJQURrQjtBQUU5QkMsRUFBQUEsY0FBYyxFQUFFQyxJQUFJLENBQUNDLEVBQUw7QUFGYyxDQUFQLENBQXpCOztBQUZBLGNBQUtKLElBQUwsQ0FBVSxZQUFWLEVBQXdCLE1BQU1HLElBQUksQ0FBQ0MsRUFBTCxFQUE5Qjs7QUFKQTs7QUFDQTs7QUFDQTs7Ozs7Ozs7Ozs7Ozs7QUFTQUMsUUFBUSxDQUFDLGNBQUQsRUFBaUIsTUFBTTtBQUM3QkMsRUFBQUEsVUFBVSxDQUFDLE1BQU07QUFDZkgs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LENBQVIiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgZmV0Y2ggZnJvbSBcIm5vZGUtZmV0Y2hcIjtcbmltcG9ydCBUcmFuc2Zlcldpc2UgZnJvbSBcIi4uL2luZGV4XCI7XG5pbXBvcnQgeyBjb25zdHJ1Y3RFdmVudCB9IGZyb20gXCIuLi93ZWJob29rc1wiO1xuXG5qZXN0Lm1vY2soXCJub2RlLWZldGNoXCIsICgpID0+IGplc3QuZm4oKSk7XG5cbmplc3QubW9jayhcIi4uL3dlYmhvb2tzXCIsICgpID0+ICh7XG4gIF9fZXNNb2R1bGU6IHRydWUsXG4gIGNvbnN0cnVjdEV2ZW50OiBqZXN0LmZuKClcbn0pKTtcblxuZGVzY3JpYmUoXCJUcmFuc2Zlcldpc2VcIiwgKCkgPT4ge1xuICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICBqZXN0LnJlc2V0QWxsTW9ja3MoKTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJjb25zdHJ1Y3RvclwiLCAoKSA9PiB7XG4gICAgdGVzdChcIml0IFRIUk9XUyBpZiBubyB0b2tlbiBpcyBnaXZlblwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB0dyA9ICgpID0+IG5ldyBUcmFuc2Zlcldpc2UoKTtcbiAgICAgIGV4cGVjdCh0dykudG9UaHJvd0Vycm9yKG5ldyBFcnJvcihcInRva2VuIGlzIHJlcXVpcmVkXCIpKTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJpdCBzZXRzIGluc3RhbmNlIHZhcmlhYmxlcyBjb3JyZWN0bHkgZm9yIHNhbmRib3hcIiwgKCkgPT4ge1xuICAgICAgY29uc3QgdHcgPSBuZXcgVHJhbnNmZXJXaXNlKHsgdG9rZW46IFwiMTIzNFwiLCBzYW5kYm94OiB0cnVlIH0pO1xuICAgICAgZXhwZWN0KHR3LnRva2VuKS50b0VxdWFsKFwiMTIzNFwiKTtcbiAgICAgIGV4cGVjdCh0dy5zYW5kYm94KS50b0VxdWFsKHRydWUpO1xuICAgICAgZXhwZWN0KHR3LnVybCkudG9FcXVhbChcImh0dHBzOi8vYXBpLnNhbmRib3gudHJhbnNmZXJ3aXNlLnRlY2hcIik7XG4gICAgfSk7XG5cbiAgICB0ZXN0KFwiaXQgc2V0cyBpbnN0YW5jZSB2YXJpYWJsZXMgY29ycmVjdGx5IGZvciBsaXZlXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiB9KTtcbiAgICAgIGV4cGVjdCh0dy50b2tlbikudG9FcXVhbChcIjEyMzRcIik7XG4gICAgICBleHBlY3QodHcuc2FuZGJveCkudG9FcXVhbChmYWxzZSk7XG4gICAgICBleHBlY3QodHcudXJsKS50b0VxdWFsKFwiaHR0cHM6Ly9hcGkudHJhbnNmZXJ3aXNlLmNvbVwiKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJyZXF1ZXN0XCIsICgpID0+IHtcbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGZldGNoLm1vY2tSZXR1cm5WYWx1ZSh7IHRoZW46IGplc3QuZm4oKSB9KTtcbiAgICB9KTtcblxuICAgIHRlc3QoXCJpdCBjYWxscyBmZXRjaCB3aXRoIGRlZmF1bHRzXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogdHJ1ZSB9KTtcbiAgICAgIHR3LnJlcXVlc3QoKTtcbiAgICAgIGV4cGVjdChmZXRjaCkudG9IYXZlQmVlbkNhbGxlZFRpbWVzKDEpO1xuICAgICAgZXhwZWN0KGZldGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgXCJodHRwczovL2FwaS5zYW5kYm94LnRyYW5zZmVyd2lzZS50ZWNoL3YxXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiR0VUXCIsXG4gICAgICAgICAganNvbjogdHJ1ZSxcbiAgICAgICAgICBoZWFkZXJzOiB7XG4gICAgICAgICAgICBBdXRob3JpemF0aW9uOiBgQmVhcmVyIDEyMzRgLFxuICAgICAgICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgICAgICAgICBcImNhY2hlLWNvbnRyb2xcIjogXCJuby1jYWNoZVwiXG4gICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIml0IGNhbGxzIGZldGNoIHdpdGggY3VzdG9tIHZlcnNpb24gJiBwYXRoXCIsICgpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogdHJ1ZSB9KTtcbiAgICAgIHR3LnJlcXVlc3QoeyB2ZXJzaW9uOiBcInYzXCIsIHBhdGg6IFwiL3Byb2ZpbGVzXCIgfSk7XG4gICAgICBleHBlY3QoZmV0Y2gpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKFxuICAgICAgICBcImh0dHBzOi8vYXBpLnNhbmRib3gudHJhbnNmZXJ3aXNlLnRlY2gvdjMvcHJvZmlsZXNcIixcbiAgICAgICAgZXhwZWN0LmFueShPYmplY3QpXG4gICAgICApO1xuICAgIH0pO1xuXG4gICAgdGVzdChcIml0IGNhbGxzIGZldGNoIHdpdGggY3VzdG9tIG1ldGhvZCAmIGpzb24gYm9keVwiLCAoKSA9PiB7XG4gICAgICBjb25zdCB0dyA9IG5ldyBUcmFuc2Zlcldpc2UoeyB0b2tlbjogXCIxMjM0XCIsIHNhbmRib3g6IHRydWUgfSk7XG4gICAgICB0dy5yZXF1ZXN0KHtcbiAgICAgICAgdmVyc2lvbjogXCJ2M1wiLFxuICAgICAgICBwYXRoOiBcIi9wcm9maWxlc1wiLFxuICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICBib2R5OiB7IHR5cGU6IFwiQkFMQU5DRVwiIH1cbiAgICAgIH0pO1xuICAgICAgZXhwZWN0KGZldGNoKS50b0hhdmVCZWVuQ2FsbGVkV2l0aChcbiAgICAgICAgXCJodHRwczovL2FwaS5zYW5kYm94LnRyYW5zZmVyd2lzZS50ZWNoL3YzL3Byb2ZpbGVzXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIGpzb246IHRydWUsXG4gICAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyB0eXBlOiBcIkJBTEFOQ0VcIiB9KSxcbiAgICAgICAgICBoZWFkZXJzOiBleHBlY3QuYW55KE9iamVjdClcbiAgICAgICAgfVxuICAgICAgKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJwcm9maWxlc1wiLCAoKSA9PiB7XG4gICAgdGVzdCgnaXQgY2FsbHMgcmVxdWVzdCB3aXRoIHsgcGF0aDogXCIvcHJvZmlsZXNcIiB9JywgKCkgPT4ge1xuICAgICAgY29uc3QgdHcgPSBuZXcgVHJhbnNmZXJXaXNlKHsgdG9rZW46IFwiMTIzNFwiLCBzYW5kYm94OiB0cnVlIH0pO1xuICAgICAgdHcucmVxdWVzdCA9IGplc3QuZm4oKTtcbiAgICAgIHR3LnByb2ZpbGVzKCk7XG4gICAgICBleHBlY3QodHcucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoeyBwYXRoOiBcIi9wcm9maWxlc1wiIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcImJvcmRlcmxlc3NBY2NvdW50c1wiLCAoKSA9PiB7XG4gICAgdGVzdCgnaXQgY2FsbHMgcmVxdWVzdCB3aXRoIHsgcGF0aDogXCIvYm9yZGVybGVzcy1hY2NvdW50cz9wcm9maWxlSWQ9MjQ4NlwiIH0nLCAoKSA9PiB7XG4gICAgICBjb25zdCB0dyA9IG5ldyBUcmFuc2Zlcldpc2UoeyB0b2tlbjogXCIxMjM0XCIsIHNhbmRib3g6IHRydWUgfSk7XG4gICAgICB0dy5yZXF1ZXN0ID0gamVzdC5mbigpO1xuICAgICAgdHcuYm9yZGVybGVzc0FjY291bnRzKDI0ODYpO1xuICAgICAgZXhwZWN0KHR3LnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHtcbiAgICAgICAgcGF0aDogXCIvYm9yZGVybGVzcy1hY2NvdW50cz9wcm9maWxlSWQ9MjQ4NlwiXG4gICAgICB9KTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgZGVzY3JpYmUoXCJyZWNpcGllbnRBY2NvdW50c1wiLCAoKSA9PiB7XG4gICAgdGVzdC5lYWNoKFtcbiAgICAgIFtcbiAgICAgICAgXCJjcmVhdGVcIixcbiAgICAgICAgeyBtZXRob2Q6IFwiUE9TVFwiLCBwYXRoOiBcIi9hY2NvdW50c1wiLCBib2R5OiB7IHByb2ZpbGU6IDI0ODYgfSB9LFxuICAgICAgICB7IHByb2ZpbGU6IDI0ODYgfVxuICAgICAgXSxcbiAgICAgIFtcImdldFwiLCB7IHBhdGg6IFwiL2FjY291bnRzLzIyMjIyMlwiIH0sIDIyMjIyMl0sXG4gICAgICBbXCJkZWxldGVcIiwgeyBtZXRob2Q6IFwiREVMRVRFXCIsIHBhdGg6IFwiL2FjY291bnRzLzIyMjIyMlwiIH0sIDIyMjIyMl0sXG4gICAgICBbXCJsaXN0XCIsIHsgcGF0aDogXCIvYWNjb3VudHM/Y3VycmVuY3k9R0JQXCIgfSwgeyBjdXJyZW5jeTogXCJHQlBcIiB9XVxuICAgIF0pKFwiLiVzIGNhbGxzIHJlcXVlc3Qgd2l0aCAlb1wiLCAoZm4sIHBhcmFtcywgaW5wdXQpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogdHJ1ZSB9KTtcbiAgICAgIHR3LnJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gICAgICB0dy5yZWNpcGllbnRBY2NvdW50c1tmbl0oaW5wdXQpO1xuICAgICAgZXhwZWN0KHR3LnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBhcmFtcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwicXVvdGVzXCIsICgpID0+IHtcbiAgICB0ZXN0LmVhY2goW1xuICAgICAgW1widGVtcG9yYXJ5XCIsIHsgcGF0aDogXCIvcXVvdGVzP3NvdXJjZT1HQlBcIiB9LCB7IHNvdXJjZTogXCJHQlBcIiB9XSxcbiAgICAgIFtcbiAgICAgICAgXCJjcmVhdGVcIixcbiAgICAgICAgeyBtZXRob2Q6IFwiUE9TVFwiLCBwYXRoOiBcIi9xdW90ZXNcIiwgYm9keTogeyBwcm9maWxlOiAyNDg2IH0gfSxcbiAgICAgICAgeyBwcm9maWxlOiAyNDg2IH1cbiAgICAgIF0sXG4gICAgICBbXCJnZXRcIiwgeyBwYXRoOiBcIi9xdW90ZXMvMjIyMjIyXCIgfSwgMjIyMjIyXVxuICAgIF0pKFwiLiVzIGNhbGxzIHJlcXVlc3Qgd2l0aCAlb1wiLCAoZm4sIHBhcmFtcywgaW5wdXQpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogdHJ1ZSB9KTtcbiAgICAgIHR3LnJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gICAgICB0dy5xdW90ZXNbZm5dKGlucHV0KTtcbiAgICAgIGV4cGVjdCh0dy5yZXF1ZXN0KS50b0hhdmVCZWVuQ2FsbGVkV2l0aChwYXJhbXMpO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcInRyYW5zZmVyc1wiLCAoKSA9PiB7XG4gICAgdGVzdC5lYWNoKFtcbiAgICAgIFtcbiAgICAgICAgXCJjcmVhdGVcIixcbiAgICAgICAgeyBtZXRob2Q6IFwiUE9TVFwiLCBwYXRoOiBcIi90cmFuc2ZlcnNcIiwgYm9keTogeyB0YXJnZXRBY2NvdW50OiAyMjIyMjIgfSB9LFxuICAgICAgICB7IHRhcmdldEFjY291bnQ6IDIyMjIyMiB9LFxuICAgICAgICBudWxsXG4gICAgICBdLFxuICAgICAgW1xuICAgICAgICBcImNhbmNlbFwiLFxuICAgICAgICB7IG1ldGhvZDogXCJQVVRcIiwgcGF0aDogXCIvdHJhbnNmZXJzLzIyMjIyMi9jYW5jZWxcIiB9LFxuICAgICAgICAyMjIyMjIsXG4gICAgICAgIG51bGxcbiAgICAgIF0sXG4gICAgICBbXCJnZXRcIiwgeyBwYXRoOiBcIi90cmFuc2ZlcnMvMjIyMjIyXCIgfSwgMjIyMjIyLCBudWxsXSxcbiAgICAgIFtcImlzc3Vlc1wiLCB7IHBhdGg6IFwiL3RyYW5zZmVycy8yMjIyMjIvaXNzdWVzXCIgfSwgMjIyMjIyLCBudWxsXSxcbiAgICAgIFtcbiAgICAgICAgXCJmdW5kXCIsXG4gICAgICAgIHtcbiAgICAgICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgICAgIHZlcnNpb246IFwidjNcIixcbiAgICAgICAgICBwYXRoOiBcIi9wcm9maWxlcy8yNDg2L3RyYW5zZmVycy8yMjIyMjIvcGF5bWVudHNcIixcbiAgICAgICAgICBib2R5OiB7IHR5cGU6IFwiQkFMQU5DRVwiIH1cbiAgICAgICAgfSxcbiAgICAgICAgMjQ4NixcbiAgICAgICAgMjIyMjIyXG4gICAgICBdLFxuICAgICAgW1xuICAgICAgICBcImRlbGl2ZXJ5RXN0aW1hdGVcIixcbiAgICAgICAgeyBwYXRoOiBcIi9kZWxpdmVyeS1lc3RpbWF0ZXMvMjIyMjIyXCIgfSxcbiAgICAgICAgMjIyMjIyLFxuICAgICAgICBudWxsXG4gICAgICBdLFxuICAgICAgW1wibGlzdFwiLCB7IHBhdGg6IFwiL3RyYW5zZmVycz9wcm9maWxlPTI0ODZcIiB9LCB7IHByb2ZpbGU6IDI0ODYgfSwgbnVsbF1cbiAgICBdKShcIi4lcyBjYWxscyByZXF1ZXN0IHdpdGggJW9cIiwgKGZuLCBwYXJhbXMsIGlucHV0LCBpbnB1dDIpID0+IHtcbiAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogdHJ1ZSB9KTtcbiAgICAgIHR3LnJlcXVlc3QgPSBqZXN0LmZuKCk7XG4gICAgICB0dy50cmFuc2ZlcnNbZm5dKGlucHV0LCBpbnB1dDIpO1xuICAgICAgZXhwZWN0KHR3LnJlcXVlc3QpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHBhcmFtcyk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKFwic2ltdWxhdGlvblwiLCAoKSA9PiB7XG4gICAgZGVzY3JpYmUoXCJ0cmFuc2ZlcnNcIiwgKCkgPT4ge1xuICAgICAgdGVzdC5lYWNoKFtcbiAgICAgICAgW1xuICAgICAgICAgIFwicHJvY2Vzc2luZ1wiLFxuICAgICAgICAgIHsgcGF0aDogXCIvc2ltdWxhdGlvbi90cmFuc2ZlcnMvMjIyMjIyL3Byb2Nlc3NpbmdcIiB9LFxuICAgICAgICAgIDIyMjIyMlxuICAgICAgICBdLFxuICAgICAgICBbXG4gICAgICAgICAgXCJmdW5kc0NvbnZlcnRlZFwiLFxuICAgICAgICAgIHsgcGF0aDogXCIvc2ltdWxhdGlvbi90cmFuc2ZlcnMvMjIyMjIyL2Z1bmRzX2NvbnZlcnRlZFwiIH0sXG4gICAgICAgICAgMjIyMjIyXG4gICAgICAgIF0sXG4gICAgICAgIFtcbiAgICAgICAgICBcIm91dGdvaW5nUGF5bWVudFNlbnRcIixcbiAgICAgICAgICB7IHBhdGg6IFwiL3NpbXVsYXRpb24vdHJhbnNmZXJzLzIyMjIyMi9vdXRnb2luZ19wYXltZW50X3NlbnRcIiB9LFxuICAgICAgICAgIDIyMjIyMlxuICAgICAgICBdLFxuICAgICAgICBbXG4gICAgICAgICAgXCJib3VuY2VkQmFja1wiLFxuICAgICAgICAgIHsgcGF0aDogXCIvc2ltdWxhdGlvbi90cmFuc2ZlcnMvMjIyMjIyL2JvdW5jZWRfYmFja1wiIH0sXG4gICAgICAgICAgMjIyMjIyXG4gICAgICAgIF0sXG4gICAgICAgIFtcbiAgICAgICAgICBcImZ1bmRzUmVmdW5kZWRcIixcbiAgICAgICAgICB7IHBhdGg6IFwiL3NpbXVsYXRpb24vdHJhbnNmZXJzLzIyMjIyMi9mdW5kc19yZWZ1bmRlZFwiIH0sXG4gICAgICAgICAgMjIyMjIyXG4gICAgICAgIF1cbiAgICAgIF0pKFwiLiVzIGNhbGxzIHJlcXVlc3Qgd2l0aCAlb1wiLCAoZm4sIHBhcmFtcywgaW5wdXQpID0+IHtcbiAgICAgICAgY29uc3QgdHcgPSBuZXcgVHJhbnNmZXJXaXNlKHsgdG9rZW46IFwiMTIzNFwiLCBzYW5kYm94OiB0cnVlIH0pO1xuICAgICAgICB0dy5yZXF1ZXN0ID0gamVzdC5mbigpO1xuICAgICAgICB0dy5zaW11bGF0aW9uLnRyYW5zZmVyc1tmbl0oaW5wdXQpO1xuICAgICAgICBleHBlY3QodHcucmVxdWVzdCkudG9IYXZlQmVlbkNhbGxlZFdpdGgocGFyYW1zKTtcbiAgICAgIH0pO1xuICAgIH0pO1xuICB9KTtcblxuICBkZXNjcmliZShcIndlYmhvb2tzXCIsICgpID0+IHtcbiAgICBkZXNjcmliZShcImNvbnN0cnVjdEV2ZW50XCIsICgpID0+IHtcbiAgICAgIHRlc3QoXCJjb25zdHJ1Y3RFdmVudCBjYWxscyBjb25zdHJ1Y3RFdmVudCB3aXRoIChzYW5kYm94PXRydWUsIHBheWxvYWQsIHNpZ25hdHVyZSlcIiwgKCkgPT4ge1xuICAgICAgICBjb25zdCB0dyA9IG5ldyBUcmFuc2Zlcldpc2UoeyB0b2tlbjogXCIxMjM0XCIsIHNhbmRib3g6IHRydWUgfSk7XG4gICAgICAgIHR3LndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KFwicGF5bG9hZFwiLCBcInNpZ25hdHVyZVwiKTtcbiAgICAgICAgZXhwZWN0KGNvbnN0cnVjdEV2ZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICAgIGV4cGVjdChjb25zdHJ1Y3RFdmVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgdHJ1ZSxcbiAgICAgICAgICBcInBheWxvYWRcIixcbiAgICAgICAgICBcInNpZ25hdHVyZVwiXG4gICAgICAgICk7XG4gICAgICB9KTtcblxuICAgICAgdGVzdChcImNvbnN0cnVjdEV2ZW50IGNhbGxzIGNvbnN0cnVjdEV2ZW50IHdpdGggKHNhbmRib3g9dHJ1ZSwgcGF5bG9hZCwgc2lnbmF0dXJlKVwiLCAoKSA9PiB7XG4gICAgICAgIGNvbnN0IHR3ID0gbmV3IFRyYW5zZmVyV2lzZSh7IHRva2VuOiBcIjEyMzRcIiwgc2FuZGJveDogZmFsc2UgfSk7XG4gICAgICAgIHR3LndlYmhvb2tzLmNvbnN0cnVjdEV2ZW50KFwicGF5bG9hZFwiLCBcInNpZ25hdHVyZVwiKTtcbiAgICAgICAgZXhwZWN0KGNvbnN0cnVjdEV2ZW50KS50b0hhdmVCZWVuQ2FsbGVkVGltZXMoMSk7XG4gICAgICAgIGV4cGVjdChjb25zdHJ1Y3RFdmVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoXG4gICAgICAgICAgZmFsc2UsXG4gICAgICAgICAgXCJwYXlsb2FkXCIsXG4gICAgICAgICAgXCJzaWduYXR1cmVcIlxuICAgICAgICApO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXX0=